<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Devlog Journal - Sprite Adventure</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>

  <div class="devlog-header">
    <h1 class="devlog-title">Devlog Journal</h1>
    <a href="/index.html" class="back-button">‚Üê Back to Menu</a>
  </div>

  <div class="devlog-form">
    <h2>Add New Entry</h2>
    <form action="/devlog" method="POST">
      <input type="text" name="title" placeholder="Entry title" required><br>
      <textarea name="content" rows="8" placeholder="Write your update here..." required></textarea><br>
      <button type="submit">Add Entry</button>
    </form>
  </div>

  <div class="devlog-entries">
    {{#entries}}
    <div class="entry" data-id="{{id}}">
      <h2>{{title}}</h2>
      <div class="entry-body">{{{content}}}</div>
      <div class="entry-actions">
        <button class="expand-btn">Expand</button>
        <button class="edit-btn">Edit</button>
        <form action="/devlog/delete/{{id}}" method="POST" class="delete-form">
          <button type="submit" class="delete-btn">Delete</button>
        </form>
      </div>
    </div>
    {{/entries}}

    {{^entries}}
    <p>No entries yet. Add one above!</p>
    {{/entries}}
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      
      document.querySelectorAll('.expand-btn').forEach(button => {
        button.addEventListener('click', () => {
          const entry = button.closest('.entry');
          const content = entry.querySelector('.entry-body');
          const isExpanded = content.classList.toggle('expanded');
          button.textContent = isExpanded ? 'Collapse' : 'Expand';
        });
      });

      document.querySelectorAll('.edit-btn').forEach(button => {
        button.addEventListener('click', () => {
          const entry = button.closest('.entry');
          const entryId = entry.dataset.id;
          const titleEl = entry.querySelector('h2');
          const contentEl = entry.querySelector('.entry-body');

          const currentTitle = titleEl.textContent;
          const currentContent = contentEl.innerText;

          const newTitle = prompt("Edit Title:", currentTitle);
          const newContent = prompt("Edit Content:", currentContent);

          if (newTitle && newContent) {
            fetch(`/devlog/edit/${entryId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ title: newTitle, content: newContent })
            }).then(res => {
              if (res.ok) {
                location.reload();
              } else {
                alert("Failed to update entry.");
              }
            });
          }
        });
      });
    });
  </script>

</body>
</html>
